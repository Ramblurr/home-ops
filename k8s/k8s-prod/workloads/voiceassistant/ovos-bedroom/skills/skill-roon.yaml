---
# yaml-language-server: $schema=https://github.com/yannh/kubernetes-json-schema/raw/master/v1.27.4-standalone-strict/statefulset-apps-v1.json
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: &name bedroom-roon-skill
  namespace: voiceassistant
spec:
  serviceName: *name
  replicas: 1
  selector:
    matchLabels:
      app: *name
  template:
    metadata:
      labels:
        app: *name
    spec:
      containers:
        - name: ramblurr-skill-roon
          image: ghcr.io/ramblurr/ovos-skill-roon:dev@sha256:63e73f062d9f7900df3c9a2820426ef4662ddee7170e6737ff3726bd1acff7b4
          imagePullPolicy: IfNotPresent
          args: [skill]
          env: &base-env
            - name: TZ
              value: Europe/Berlin
            - name: HOME
              value: /home/ovos
            - name: ROON_PROXY_SOCK
              value: tcp://127.0.0.1:5654
            - name: ROON_PUBSUB_SOCK
              value: tcp://127.0.0.1:5655
          volumeMounts:
            - name: ovos-mycroft-config
              mountPath: /home/ovos/.config
              subPath: bedroom-skills/config
            - name: ovos-mycroft-config
              mountPath: /home/ovos/.local/share
              subPath: bedroom-skills/share
            - name: ovos-tmp
              mountPath: /tmp/mycroft
        - name: roon-proxy
          image: ghcr.io/ramblurr/ovos-skill-roon:dev@sha256:63e73f062d9f7900df3c9a2820426ef4662ddee7170e6737ff3726bd1acff7b4
          imagePullPolicy: IfNotPresent
          args: [server]
          env: *base-env
      volumes:
        - name: ovos-mycroft-config
          persistentVolumeClaim:
            claimName: ovos-data-nfs
        - name: ovos-tmp
          emptyDir: {}
      securityContext:
        fsGroup: 2000
        runAsGroup: 2000
        runAsUser: 1000
